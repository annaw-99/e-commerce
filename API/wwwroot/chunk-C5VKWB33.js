import{b as k,ia as j,k as D,n as T}from"./chunk-BMBN6P24.js";import{Db as C,Fc as b,Ib as a,Jb as o,Nc as M,Sc as P,Tb as v,db as d,dc as l,ea as S,ec as f,fc as U,ka as u,lc as E,oa as _,ob as h,pc as p,qc as s,ub as w,x as g}from"./chunk-EPYIBYH4.js";var A="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var F=(i=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)t+=A[e[i]&63];return t};var y=class{id=F();items=[];deliveryMethodId;paymentIntentId;clientSecret};var x=class i{baseUrl=T.apiUrl;http=u(k);cart=h(null);itemCount=b(()=>this.cart()?.items.reduce((t,e)=>t+e.quantity,0));selectedDelivery=h(null);totals=b(()=>{let t=this.cart(),e=this.selectedDelivery();if(!t)return null;let r=t.items.reduce((m,I)=>m+I.price*I.quantity,0),n=e?e.price:0,c=0;return{subtotal:r,shipping:n,discount:c,total:r+n-c}});getCart(t){return this.http.get(this.baseUrl+"cart?id="+t).pipe(g(e=>(this.cart.set(e),e)))}setCart(t){return this.http.post(this.baseUrl+"cart",t).subscribe({next:e=>this.cart.set(e)})}addItemToCart(t,e=1){let r=this.cart()??this.createCart();this.isProduct(t)&&(t=this.mapProductToCartItem(t)),r.items=this.addOrUpdateItem(r.items,t,e),this.setCart(r)}removeItemFromCart(t,e=1){let r=this.cart();if(!r)return;let n=r.items.findIndex(c=>c.productId===t);n!==-1&&(r.items[n].quantity>e?r.items[n].quantity-=e:r.items.splice(n,1),r.items.length===0?this.deleteCart():this.setCart(r))}deleteCart(){this.http.delete(this.baseUrl+"cart?id="+this.cart()?.id).subscribe({next:()=>{localStorage.removeItem("cart_id"),this.cart.set(null)}})}addOrUpdateItem(t,e,r){let n=t.findIndex(c=>c.productId===e.productId);return n===-1?(e.quantity=r,t.push(e)):t[n].quantity+=r,t}mapProductToCartItem(t){return{productId:t.id,productName:t.name,price:t.price,quantity:0,pictureUrl:t.pictureUrl,brand:t.brand,type:t.type}}isProduct(t){return t.id!==void 0}createCart(){let t=new y;return localStorage.setItem("cart_id",t.id),t}static \u0275fac=function(e){return new(e||i)};static \u0275prov=S({token:i,factory:i.\u0275fac,providedIn:"root"})};function B(i,t){if(i&1&&(a(0,"div",3)(1,"dl",4)(2,"dt",5),l(3,"Subtotal"),o(),a(4,"dd",6),l(5),p(6,"currency"),o()()(),a(7,"div",7)(8,"button",8),l(9,"Checkout"),o()()),i&2){let e,r=v();d(5),f(s(6,1,(e=r.cartService.totals())==null?null:e.subtotal))}}function L(i,t){if(i&1&&(a(0,"div",2)(1,"div",3)(2,"dl",4)(3,"dt",5),l(4,"Subtotal"),o(),a(5,"dd",6),l(6),p(7,"currency"),o()(),a(8,"dl",4)(9,"dt",5),l(10,"Discount"),o(),a(11,"dd",9),l(12),p(13,"currency"),o()(),a(14,"dl",4)(15,"dt",5),l(16,"Delivery Fee"),o(),a(17,"dd",6),l(18),p(19,"currency"),o()()(),a(20,"dl",10)(21,"dt",5),l(22,"Total"),o(),a(23,"dd",6),l(24),p(25,"currency"),o()()()),i&2){let e,r,n,c,m=v();d(6),f(s(7,4,(e=m.cartService.totals())==null?null:e.subtotal)),d(6),U("-",s(13,6,(r=m.cartService.totals())==null?null:r.discount),""),d(6),f(s(19,8,(n=m.cartService.totals())==null?null:n.shipping)),d(6),f(s(25,10,(c=m.cartService.totals())==null?null:c.total))}}var O=class i{cartService=u(x);location=u(M);static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-order-summary"]],standalone:!0,features:[E],decls:4,vars:2,consts:[[1,"mx-auto","max-w-4xl","flex-1","space-y-6","w-full"],[1,"space-y-4","p-4","bg-white"],[1,"space-y-4"],[1,"space-y-2","text-sm"],[1,"flex","items-center","justify-between","gap-4"],[1,"font-medium","text-gray-500"],[1,"font-medium","text-gray-900"],[1,"flex","flex-col","gap-2"],["routerLink","/checkout","mat-flat-button","",1,"bg-black"],[1,"font-medium","text-green-500"],[1,"flex","items-center","justify-between","gap-4","border-t","border-gray-200","pt-2","text-sm"]],template:function(e,r){e&1&&(a(0,"div",0)(1,"div",1),w(2,B,10,3)(3,L,26,12,"div",2),o()()),e&2&&(d(2),C(r.location.path()!=="/checkout"?2:-1),d(),C(r.location.path()=="/checkout"?3:-1))},dependencies:[j,D,P]})};export{x as a,O as b};
